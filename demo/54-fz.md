статус документа: черновик

[![яндекс касса](/i/yakassalogo.png "Яндекс Касса")](https://kassa.yandex.ru) / документация / [http](/demo/010%20интеграция%20для%20самописных%20сайтов.md):arrow_left:, [cms](/demo/011%20интеграция%20для%20CMS%20и%20SaaS.md), [email](/010%20интеграция%20email.md), [тестирование](/demo/030%20тестирование.md), [решение ошибок](/demo/031%20решение%20ошибок.md), [демо](/demo/032%20демо%20стенд.md)

54-ФЗ. Нюансы интеграции и необходимые доработки
================================================

Эта статья в первую очередь предназначено для тех, кто использует свои собственные скрипты, для взаимодействия с Яндекс.Кассой, т.н. самописное решение.

* Обзорная публикация по теме 54-ФЗ https://kassa.yandex.ru/54fz
* 

### Требования к доработке
- [x] Зарегистрируйтесь в Атол или МодульКассе. Получите у них идентификаторы для фискализации.
- [x] Впишите полученные идентификаторы в Личном Кабинете Яндекс.Кассы https://kassa.yandex.ru/blog/lk54fz
- [ ] Если у вас сайт на CMS, обновить [платежный модуль](https://kassa.yandex.ru/54fz#modules). Если самописный сайт, то дорабойте скрипты, чтобы из платежной формы передались нужные параметры в ym_merchant_receipt.

> Внимание! Как только вы пропишите идентификаторы фискализации в личном кабинете Яндекс.Кассы, практически сразу эти настройки попадут в нашу систему и после этого, если вы не будете передавать ym_merchant_receipt, платежи перестанут работать. Поэтому в Личном кабинете прописывайте эти настройки тогда, когда уверены, что все работает корректно.

### ym_merchant_receipt

Кроме всех параметров, что вы передавали раньше из платежной формы, при включении фискализации, нужно передавать состав корзины в параметре `ym_merchant_receipt`.

Пример1:
```html
<input name="ym_merchant_receipt"
  value='{"customerContact": "+79123456543",
        "taxSystem": 1,
          "items":[
            {"quantity": 1.154,"price": {"amount": 300.23},"tax": 3,"text": "Зеленый чай, кг."},
            {"quantity": 2,"price": {"amount": 200.00},"tax": 3,"text": "Кружка для чая, шт."}
                  ]}'
type="hidden"/>
```
Подробности о "Примере1":
* В `customerContact` указан номер телефона, поэтому электронный чек будет отправлен SMS сообщением на этот номер.
* `quantity=1.154` - 1 кг 154 грамма Зеленого чая; `quantity=2` - 2 кружки для чая
* `amount=300.23` - цена за 1 кг Зеленого чая; `amount=200.00` - цена за одну кружку
* `taxSystem=1` - Система налогообложения магазина общая СН
* `tax=3` - НДС чека по ставке 10%
* Обратите внимание, что параметры передаты в одинарных кавычках `value='JSON'`, так правильно. Ни в коем случае не передавайте так -- `value="JSON"`, платеж пройдет, но в фискализацию все данные не попадут.

Пример2:
```html
<input name="ym_merchant_receipt"
  value="{"customerContact": "inbox@usermail.tld",
        "taxSystem": 1,
          "items":[
            {"quantity": 1.154,"price": {"amount": 300.23},"tax": 3,"text": "Товар А"},
            {"quantity": 2,"price": {"amount": 200.00},"tax": 3,"text": "Товар Б"}
                  ]}"
type="hidden"/>
```
Документация https://tech.yandex.ru/money/doc/payment-solution/payment-form/payment-form-receipt-docpage/

### FAQ

#### // CMS

**Q:** Мой сайт сделат на CMS. Какие модули уже поддерживают 54-ФЗ?

**A:** Актуальный список модулей здесь https://kassa.yandex.ru/54fz#modules

#### // Электронный чек

**Q:** Что будет, если покупатель не указал номер телефона и электронный адрес в `customerContact`?

**A:** Платеж не пройдет. Поэтому проверяйте на своей стороне условие, чтобы этот параметр был заполнен и заполнен корректно.
