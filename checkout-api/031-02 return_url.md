

[![яндекс касса](/i/yakassalogo.png "Яндекс Касса")](https://kassa.yandex.ru) / [помощь](https://yandex.ru/support/checkout/) / [api-докуметация](https://kassa.yandex.ru/docs/checkout-api/#api-yandex-kassy), [api-гайды](https://kassa.yandex.ru/docs/guides/#bystryj-start), [YandexCheckout.js](https://kassa.yandex.ru/docs/checkout-js/#yandexcheckout-js)

Return_url. Рекомендации по реализации
======================================

### Один платеж, один `return_url`

> При [создании платежа](https://kassa.yandex.ru/docs/checkout-api/#sozdanie-platezha) в параметре `return_url` вы передаете ссылку, которая будет работать на любом этапе платежа как ссылка кнопки "вернуться в магазин". Определение статуса платежа в момент перехода на вашу страницу `return_url` необходимо выполнить через [запрос о статусе платежа](https://kassa.yandex.ru/docs/checkout-api/#informaciq-o-platezhe).

#### За и против

"Один `return_url`?", - вполне адекватный вопрос программиста, привыкшего к реализации, когда URL-ы страницы для успеха, ошибки или иного статуса, заранее известны. Почему в нашем API мы выбрали вариант, когда страница одна?

##### Пример оплаты методом Сбербанк-онлайн

Вариант1
Плательщик получил смс с номера 900, подтвердил, но в сбербанке сбой в компоненте оплаты. Или у мобильного оператора очередь доставки смс. Сам пользователь не нажал кнопку отправки смс или телефон по каким-то причинам не выполнил отправку смс. Факт: платеж не оплачен. На какую страницу должна вести ссылка "Вернуться в магазин" в этот момент времени? Успех? Нет. Ошибки? Нет. Промежуточный статус? Возможно. А если в момент перехода по ссылке "Вернуться в магазин" статус изменился, смс дошла, деньги списались, а вы плательщику покажете "Что-то пошло не так". В общем, довольно сложно сделать 100%-ное попадание.

Решение1: После перехода плательщика на страницу `return_url` сделать запрос и показать актуальный статус.

Вариант2
Плательщик не получил никакой смс или не понял что ему делать и поэтому просто вернулся обратно на сайт нажав на кнопку "Вернуться в магазин". Куда он должен попасть?

Решение1: После перехода плательщика на страницу `return_url` сделать запрос и показать актуальный статус.

Вариант3
Плательщик все сделал верно, все смс пришли, сбербанк и все остальные списали деньги с пользователя. Казалось бы, кнопка "вернуться в магазин" на страницу для успеха самое верное решение. Но оказалось, что пока плательщик платил, выяснилось, что товара нет на складе, не тот цвет или не надлежащего качества. Плательщик оплатил и перешел на вашу страницу Успеха?



### Чего не будет

Сценарий, к которому привыкли пользователи нашего старого API и которого теперь не будет. В старом API было три ссылки:
* shopDefaultUrl - ссылка "вернуться в магазин", на странице платежа до момента осуществления оплаты;
* shopSuccessURL - ссылка на странице успеха платежа, после успешной оплаты;
* shopFailURL - ссылка на странице, которая отображается после нажатия кнопки "оплатить" и если оплата была не успешной (не достаточно средств, не пройден 3DS и т.д.)

Теперь только одна ссылка, значение которой передается в `return_url`.
